{% extends '_layouts/base_portal.html' %}
{% load staticfiles %}

{% block title %}Requests{% endblock title %}

{% block css %}
{% endblock css %}

{% block header %}
    <h1>Requisition</h1>
      <ol class="breadcrumb">
        <li id="messageNotification">
          {% include "_includes/messages.html" with messages=messages %}
        </li>
      </ol>
{% endblock header %}


{% block content %}
    <section class="invoice">
    <div class="row">
      <div class="col-xs-12">
        <a href="{% url 'requisitions' %}"><i class="fa fa-angle-left"></i> Back</a>
      </div>
    </div>

      <div class="row">
        <div class="col-xs-12">
          <h2 class="page-header">
            <i class="fa fa-globe"></i> {{ requisition.buyerCo }}
            <small class="pull-right">Date Requested: <em>{{ requisition.date_issued }}</em></small>
          </h2>
        </div>
      </div>

      <!-- Request Details -->
      <div class="row invoice-info">
      	<div class="col-xs-12">
          <p class="lead">Requisition Details</p>
        </div>
        <div class="col-sm-6 invoice-col">
          	<b>Department:</b> {{ requisition.department }}<br>
			      <b>Preparer:</b> {{ requisition.preparer }}<br>
          	<b>Next Approver:</b> {{ requisition.next_approver }}<br>
        </div>
        <div class="col-sm-6 invoice-col">
          <b>Request Number:</b> {{ requisition.number }}<br>
          <b>Currency:</b> {{ requisition.currency }}<br>
          <b>Date Due:</b> {{ requisition.date_due }}<br>
          <b>Status:</b> {{ latest_status }} 
            {% if latest_status == 'Approved' %}
            <i class="fa fa-check" style="color: green" aria-hidden="true"> </i>
            {% elif latest_status == 'Pending' %}
            <i class="fa fa-question" style="color: orange" aria-hidden="true"> </i>
            {% elif latest_status == 'Denied' %}
            <i class="fa fa-close" style="color: red" aria-hidden="true"> </i>
            {% endif %}
          <br>
        </div>
      </div>

      <!-- Order Item in Request -->
      <div class="row">
        <div class="col-xs-12">
      	 <p class="lead">Order Details</p>
        </div>
        <div class="col-xs-12 table-responsive">
          <table class="table table-striped">
            <thead>
            <tr>
              <th>Product</th>
              <th>Quantity</th>
              <th>Cost Per Unit</th>
              <th>Sub-total</th>
              <th>Comments</th>
            </tr>
            </thead>

            <tbody>
            {% for order_item in requisition.order_items.all %}
            <tr>
              <td>{{ order_item.product.name }}</td>
              <td>{{ order_item.quantity }}</td>
              <td>{{ order_item.product.unit_price }}</td>
              <td>{{ order_item.sub_total }}</td>
              <td>{{ order_item.comments }}</td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div><br>

	  <!-- Comments & Total -->
      <div class="row">      
        <div class="col-xs-12">
        {% if requisition.comments %}
          <p class="lead">Comments</p>
          <p class="text-muted well well-sm no-shadow" style="margin-top: 10px;"> {{ requisition.comments }}</p>
        </div>
        {% endif %}

        <div class="col-xs-12">
          <p class="lead pull-right">Total Cost: {{ requisition.buyer_co.currency }} {{ requisition.sub_total }}</p>
        </div>
      </div><br>
      
      <div class="row no-print">
        <div class="col-xs-12">          
        <!-- Show only if Approver Role -->
          {% if user.buyer_profile.role == 1 or user.buyer_profile.role == 3 %}
            {% if latest_status == 'Pending' %}
              <form method="post">
                {% csrf_token %}
                <button type="submit" name="approve" value="approve" class="btn basic-teal pull-right"><i class="fa fa-check"></i> Approve Order</button>
                <button type="submit" name="deny" value="deny" class="btn basic-grey pull-right"><i class="fa fa-times"></i> Deny Order</button>
              </form>
            {% endif %}
          {% endif %}          
        </div>
      </div>
    </section>
   
    <div class="clearfix"></div>
{% endblock content %}


{% block js %}
  {% include "_includes/dataTablesNotifications.html" with tableID="catalogTable" %}
{% endblock js %}