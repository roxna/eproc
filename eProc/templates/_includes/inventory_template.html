{% extends '_layouts/base_portal.html' %}
{% load staticfiles %}

{% block title %}{{title}}{% endblock title %}

{% block css %}
{% endblock css %}

{% block header %}{{title}}{% endblock header %}

{% block content %}
<section class="content">
  <div class="row"> 

  <!-- TABLE LIST OF ITEMS -->
    <div class="col-lg-7 col-xs-12">    
      <div class="box box-default"> 

        <div class="box-header with-border">
          <h3 class="box-title">{{subtitle}}</h3>
        </div>     

        <div class="box-body">
            <table id="{{tableID}}" class="table table-striped">
                 <thead class="basic-grey">
                  <tr>
                    <th>Product</th>                        
                    <th>Quantity</th>
                    <th>Latest Status</th>
                    <th>By</th>
                  </tr>
                </thead>
                
                <tbody> 
                  {% for item in items %}           
                  <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{% include "_includes/status_formatting_wo_href.html" with item=item value_to_display=item.get_latest_status %}</td>
                    <td>{{ item.get_latest_status.get_status_details }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
            </table>
        </div>  

      </div>  
    </div>

    <!-- CHART AGGREGATION OF ITEMS -->
    <div class="col-lg-5 col-xs-12">
      <div class="box box-default">     
        <div class="box-header with-border">
          <h3 class="box-title">Items</h3>
        </div>       
        <div class="box-body">
          <canvas id="{{chartID}}" height="300" width="300"></canvas>
        </div>
      </div>   
    </div>
  
  </div>
</section>

{% endblock content %}

{% block js %}
  {% include "_includes/dataTablesNotifications.html" with tableID=tableID %}
  <script src="{% static 'plugins/chartjs/Chart.min.js' %}"></script>

  <script>
    $(function () {
      var chartCtx = $("#{{chardID}}").get(0).getContext("2d");      
      var chartData = [];
      {% for item in itemCount %}
        deptData[{{forloop.counter0}}] = {
          value: {{item.total_cost}},
          label: '{{item.product__name}}',
          color: 'hsl(' + 160 + ', ' + Math.floor(Math.random() * 100) + '%, ' + Math.floor(Math.random() * 100) + '%)',
        };
      {% endfor %}
      var chartOptions = {
        tooltipTemplate: "<%= label %> ($<%= value %>)",
        animation : false,
      };
      var inventoryChart = new Chart(chartCtx).Pie(chartData, chartOptions);
    }); 
{% endblock js %}